                             +-----------------------+
                             |     Client (Web)      |
                             |  Next.js App Router   |
                             +----------+------------+
                                        |
                               HTTPS / Edge Runtime
                                        |
                 +----------------------+----------------------+
                 |                                             |
      +----------v-----------+                      +----------v-----------+
      |   Server Actions &   |                      |  API Routes / Jobs   |
      |   React Components   |                      | (Vercel Functions &  |
      |   (Next.js, shadcn)  |                      |    Cron Schedules)   |
      +----------+-----------+                      +----------+-----------+
                 |                                             |
    Auth (Supabase Session)                        Webhooks / Scheduled Tasks
                 |                                             |
+----------------v-------------------+          +--------------v-------------+
|        Supabase (Postgres)         |          |  Provider Integrations      |
|  - Auth & RLS-secured Tables       |          |  - Garmin Connect API       |
|  - Storage (avatars, exports)      |          |  - Withings API             |
|  - Edge Functions / Triggers       |          |  - Manual uploads / CSV     |
|  - pg_cron / Functions for ETL     |          +--------------+--------------+
|  - Logs & Policies                 |                         |
+----------------+------------------+                         |
                 |                                        Normalized payloads
                 |                                              |
        +--------v---------+                        +-----------v-----------+
        |  Calculation &   |                        |    Stripe Platform    |
        | Analytics Layer  |                        |  - Checkout / Portal  |
        |  - Materialized  |                        |  - Billing Webhooks   |
        |    Views (readiness, |                    |  - Subscriptions +    |
        |    macros, trends)   |                    |    Metered usage       |
        |  - Supabase Functions|                    +-----------+-----------+
        +--------+-------------+                                |
                 |                                       Feature entitlements
                 |                                              |
        +--------v-------------------+                 +--------v-------------------+
        | Gemini LLM (Google AI)     |                 | Observability / Analytics  |
        | - Daily/Weekly Insights    |                 | - Supabase logs            |
        | - Structured JSON outputs  |                 | - Optional PostHog client  |
        +----------------------------+                 +----------------------------+
